<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Messages - Anh Th∆∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 935px;
            margin: 0 auto;
            background: #000;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: #000;
            border-bottom: 1px solid #262626;
            padding: 12px 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-back {
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
        }

        .header-back svg {
            width: 24px;
            height: 24px;
            fill: #fff;
        }

        .header-info {
            flex: 1;
        }

        .header-title {
            font-weight: 600;
            font-size: 16px;
        }

        .header-subtitle {
            font-size: 12px;
            color: #8e8e8e;
            margin-top: 2px;
        }

        /* Audio List */
        .audio-list {
            padding: 20px;
        }

        .audio-item {
            background: #121212;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #262626;
        }

        .audio-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .audio-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .audio-avatar.sent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .audio-info {
            flex: 1;
        }

        .audio-sender {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .audio-time {
            font-size: 12px;
            color: #8e8e8e;
        }

        .audio-player {
            width: 100%;
            height: 48px;
            border-radius: 8px;
        }

        .audio-player::-webkit-media-controls-panel {
            background: #262626;
        }

        .date-divider {
            text-align: center;
            margin: 24px 0 16px;
            position: relative;
        }

        .date-divider::before,
        .date-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: #262626;
        }

        .date-divider::before {
            left: 0;
        }

        .date-divider::after {
            right: 0;
        }

        .date-text {
            display: inline-block;
            background: #000;
            padding: 0 16px;
            font-size: 12px;
            color: #8e8e8e;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e8e;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #262626;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .no-audio {
            text-align: center;
            padding: 60px 20px;
            color: #8e8e8e;
        }

        .no-audio svg {
            width: 64px;
            height: 64px;
            fill: #262626;
            margin-bottom: 16px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-back" onclick="window.location.href='index.html'">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </div>
            <div class="header-info">
                <div class="header-title">Audio Messages</div>
                <div class="header-subtitle" id="audioCount">Loading...</div>
            </div>
        </div>

        <!-- Audio List -->
        <div class="audio-list" id="audioList">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div>ƒêang t·∫£i audio...</div>
            </div>
        </div>
    </div>

    <script>
        const messageFiles = [5, 4, 3, 2, 1]; // Th·ª© t·ª± gi·ªëng index.html: t·ª´ c≈© ƒë·∫øn m·ªõi
        const audioMessages = [];
        let lastRenderedDate = '';

        // Parse m·ªôt file v√† extract audio
        async function parseMessageFile(fileNum) {
            try {
                const response = await fetch(`your_instagram_activity/messages/inbox/anhthu_473257607401794/message_${fileNum}.html`);
                const html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const messageBoxes = doc.querySelectorAll('.pam._3-95._2ph-._a6-g.uiBoxWhite.noborder');
                const messagesArray = Array.from(messageBoxes).reverse(); // ƒê·∫£o ng∆∞·ª£c ƒë·ªÉ c≈© nh·∫•t l√™n tr∆∞·ªõc

                const messages = [];

                messagesArray.forEach(box => {
                    const sender = box.querySelector('h2')?.textContent.trim() || '';
                    const contentDiv = box.querySelector('._a6-p');
                    const timeDiv = box.querySelector('._a6-o');
                    const time = timeDiv?.textContent.trim() || '';

                    if (contentDiv) {
                        const links = contentDiv.querySelectorAll('a');
                        const audioFiles = [];

                        links.forEach(a => {
                            const href = a.href;
                            const text = a.textContent.trim();

                            // Ki·ªÉm tra xem c√≥ ph·∫£i audio file kh√¥ng
                            if (href.includes('/audio/') || text.includes('Click for audio')) {
                                audioFiles.push(href);
                            }
                        });

                        // Ch·ªâ th√™m n·∫øu c√≥ audio
                        if (audioFiles.length > 0) {
                            const isSent = sender.includes('ùìëùì∏ÃÇÃÄ ùì¨ùì∏ÃÇ ùì£ùì±ùìæÃõ') || sender.includes('You');
                            audioFiles.forEach(audioUrl => {
                                messages.push({
                                    sender: sender,
                                    isSent: isSent,
                                    audioUrl: audioUrl,
                                    time: time
                                });
                            });
                        }
                    }
                });

                return messages;
            } catch (error) {
                console.error('Error loading file:', error);
                return [];
            }
        }

        // Render m·ªôt audio item
        function renderAudioItem(audio) {
            // T·∫°o date divider n·∫øu c·∫ßn
            const messageDate = audio.time.split(',')[0].trim(); // L·∫•y ng√†y (tr∆∞·ªõc d·∫•u ph·∫©y)
            let dateDividerHtml = '';
            if (messageDate !== lastRenderedDate) {
                dateDividerHtml = `
                    <div class="date-divider">
                        <span class="date-text">${messageDate}</span>
                    </div>
                `;
                lastRenderedDate = messageDate;
            }

            const avatarText = audio.isSent ? 'BT' : 'AT';
            const avatarClass = audio.isSent ? 'sent' : '';

            return `
                ${dateDividerHtml}
                <div class="audio-item">
                    <div class="audio-header">
                        <div class="audio-avatar ${avatarClass}">${avatarText}</div>
                        <div class="audio-info">
                            <div class="audio-sender">${audio.sender}</div>
                            <div class="audio-time">${audio.time}</div>
                        </div>
                    </div>
                    <audio class="audio-player" controls preload="metadata">
                        <source src="${audio.audioUrl}" type="audio/mp4">
                        <source src="${audio.audioUrl}" type="audio/aac">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            `;
        }

        // Load t·∫•t c·∫£ audio t·ª´ c√°c file
        async function loadAllAudio() {
            const audioList = document.getElementById('audioList');

            // Load tu·∫ßn t·ª± t·ª´ng file
            for (let i = 0; i < messageFiles.length; i++) {
                const fileNum = messageFiles[i];
                const messages = await parseMessageFile(fileNum);
                audioMessages.push(...messages);
            }

            // Render
            if (audioMessages.length === 0) {
                audioList.innerHTML = `
                    <div class="no-audio">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
                        </svg>
                        <div>Kh√¥ng c√≥ audio n√†o</div>
                    </div>
                `;
            } else {
                audioList.innerHTML = audioMessages.map(audio => renderAudioItem(audio)).join('');
                document.getElementById('audioCount').textContent = `${audioMessages.length} audio messages`;
            }
        }

        // Kh·ªüi ƒë·ªông
        loadAllAudio();
    </script>
</body>

</html>